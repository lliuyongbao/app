<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta charset="utf-8">

    <!-- [portable options] -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <title>待审定价单列表</title>

    <!-- [loading stylesheets] -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="css/style.css" />
    <link type="text/css" rel="stylesheet" href="css/portfolio-default.css" />
    <link type="text/css" rel="stylesheet" href="css/portfolio-component.css" />
    <link rel="stylesheet" type="text/css" href="css/icon.css">

    <!-- [loading scripts] -->

  <style type="text/css" media="screen">

  </style>
    </head>

    <body>

    	<section id="page-wrapper">

        	<section id="menu-wrapper">
                 <!-- .menu -->
          </section> <!-- #menu-wrapper -->

        	<section id="content-wrapper">

            <section id="header">

                <div id="header-left">
                    <a href="#" id="a-menu">
                        <img src="img/icons/menu.png" alt="menu" />
                    </a>
                </div>

                <div id="header-title">
                    <h1>待审定价单列表</h1>
                </div>
            </section> <!-- #header -->
                <!--搜索框-->
            <div class="wrapper">
            <!---->
                <div class="wrapper-div-form1c">
                    <h2>查询条件</h2>
                    <form action="#" method="get">
                        <div class="wrapper-form-div">
                          <label for="cus_name">
                            <span class="spnCls">发起人</span>: <input type="text" name="" value="" id="cus_name" style="height:0.24rem;" placeholder="请输入发起人" />
                          </label>

                          <label>
                           <span class="spnCls">日期</span>: <input id="dateInfo" type="date" value="" style="width:1.7rem;height:0.24rem; border:0.01rem solid #000;" /></label>
                          </br>
                           <label>
                            <span class="spnCls">产品</span>: <input id="productId" type="text" value="" placeholder="模态框多级联动显示" style="height:0.24rem;" /></label>
                                                          </br>
                           <label for="customerInfo1">
                            <span class="spnCls">客户名称</span>: <input type="text" name="" value="" id="customerInfo" style="height:0.24rem;" placeholder="请输入客户名称" />
                          </label>
                         </br>
                        </div>
                        <div align="center">
                            <input type="button" value="查询" class="chaxun" id="query" style="border:none;margin-left: 15%; width:30%;float: left;" />
                           <input type="button" value="重置" class="chaxun" id="reset" style="border:none;margin-left: 15%; width:30%;float:left;" />
                        </div>

                    </form>
                </div>
            <!---->
            </div>
            <div class="content-wrapper-div">
                <ul>
                    <li>定价单号: <span>SHT201708070003162267</span></li>
                    <li>机构名称: <span>测试用户0001</span></li>
                    <li>发起人: <span>测试用户0001</span></li>
                    <li>申请时间: <span>测试用户0001</span></li>
                    <li>客户名称: <span>测试用户0001</span></li>
                    <li>贷款种类: <span>应收账款质押贷款</span></li>
                    <li>金额: <span>10000</span></li>
                    <li>期限: <span>12个月</span></li>
                    <li>底线价格: <span>0.018696</span></li>
                    <li>目标利率(%): <span>0.018696</span></li>
                    <li>优惠利率(%): <span>0.021109</span></li>
                    <li>执行利率(%): <span>0.018696</span></li>
                    <li>状态:<span>定价完成</span></li>
                </ul>
                <div align="right" style="">
                    <input type="button" name="" value="审批" style="width: 30%;margin:0 10px 10px 0;line-height:2px;border: 1px solid #6cf; color:red;background: #ccc;">
                </div>
            </div>

        </section> <!-- #content-wrapper -->

        <!-- <div class="houtai-footer-ding">
            <a href="#">
                <img src="img/img1/shang.png" alt="回到顶部">
            </a>
        </div> --><!--回到顶部-->
        <div id="x-goto-top">
          <a href="#">
            <div id="x-arrow">
            </div>
            <div id="x-stick">
            </div>
          </a>
        </div>
        <div style="height:.45rem;width:100%">

        </div>

      </section> <!-- #page-wrapper -->

      <div class="houtai-footer1"></div>
      <div class="houtai-footer">
         <ul class="houtai-box">
              <li class="houtai-flex">
                  <a href="shouye.html">
                      <img src="img/icons/20091003100600258.png" alt="客户管理" />
                      <p>公告信息</p>
                  </a>
              </li>
              <li class="houtai-flex" id="public2">
                  <a href="daikuanshisuan.html">
                      <img src="img/icons/20091003100559341.png" alt="对公贷款定价" />
                          <p>对公贷款定价</p>
                  </a>
              </li>
              <li class="houtai-flex" id="person2">
                   <a href="gerendaikuan.html" >
                      <img src="img/icons/20091003100600651.png" alt="个人贷款定价" />
                       <p>个人贷款定价</p>
                  </a>
              </li>
              <li class="houtai-flex">
                  <a href="kehuxinxi.html" >
                      <img src="img/icons/20091003100600325.png" alt="客户信息" />
                      <p>客户信息</p>
                   </a>
              </li>
         </ul>
      </div>
          <!-- 产品模态框 -->
    <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

      <div class="modal-dialog">
        <div class="modal-content" style="border-radius:0.1rem;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel" style="font-size:0.15rem">选择产品</h4>
            </div>
            <div class="modal-body">
              <section>
                    <label id="lblSelect" class="label-12">
                      <span class="modalSpn">产品</span>:
                        <select class="selectPointOfInterest" id="product" title="Select points of interest nearby">
                            <option value="">--请选择--</option>
                        </select>
                    </label></br>
                    <label id="lblSelect" class="label-12">
                      <span class="modalSpn">子产品</span>:
                        <select class="selectPointOfInterest" id="productBranch" title="Select points of interest nearby">
                            <option value="">--请选择--</option>
                        </select>
                    </label></br>

                    <label id="lblSelect" class="label-12">
                      <span class="modalSpn">三级产品</span>:
                        <select class="selectPointOfInterest" id="productBranchTwo" title="Select points of interest nearby">
                            <option value="">--请选择--</option>
                        </select>
                    </label></br>

              </section>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="padding: 0 0.1rem;border-radius:0.05rem">取消</button>
                <button type="button" class="btn btn-primary" id="confirm2" data-dismiss="modal" style="padding: 0 0.1rem;border-radius:0.05rem">确认</button>
            </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal -->
    </div>
    </body>
    <script type="text/javascript" src="js/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/cookie.js"></script>
    <script type="text/javascript" src="js/public.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script src="js/mui.js"></script>
    <script src="js/muiBack.js"></script>
    <script type="text/javascript">
        $(function(){

          //产品模态框选择
          $("#productId").click(function(event) {
               $("#myModal2").modal();
          });

          //弹出产品模态框
          $('#myModal2').on('shown.bs.modal', function () {
            $("#product").children('option[value!=""]').remove();
            $("#productBranch").children('option[value!=""]').remove();
            $("#productBranchTwo").children('option[value!=""]').remove();
                var params={};
                params.class="appGetProductPubList";
                params.dp_prod_type=0;
                $.ajax({
                    url:port,
                    data:params,
                    dataType:'json',
                    cache:false,
                    success:function(r){
                      if (r.status){
                        for(var i=0;i<r.result.length;i++){
                             var dp_prod_id=r.result[i].dp_prod_id;
                             var dp_prod_name=r.result[i].dp_prod_name;
                             var opt="<option value='" +dp_prod_id +"'>"+dp_prod_name+"</option>";
                             $("#product").append(opt);
                         }
                      }else{
                        alert(r.message);
                      }
                    },error:function(r){
                      alert('请求失败，请稍候重试！！');
                    }
                });
          });

          //请求产品二级菜单
          $("#product").change(function(){
            $("#productBranchTwo").val("");
            productChioce(this,"appGetProductPubList2","productBranch");

           })
          //请求产品三级菜单
          $("#productBranch").change(function(){
            productChioce(this,"appGetProductPubList2","productBranchTwo");
          })

          //产品封装调用
          function productChioce(obj,cls,id){
            $("#"+id).children('option[value!=""]').remove();
            var electVal=$(obj).children('option:selected').val();
            var params={};
             params.class=cls;
             params.up_dp_prod_id=electVal;
             params.dp_prod_type=0;
            if(electVal!=""){
               $.ajax({
                    url:port,
                    data:params,
                    dataType:'json',
                    cache:false,
                    success:function(r){
                      if (r.status){
                        for(var i=0;i<r.result.length;i++){
                            var dp_prod_id=r.result[i].dp_prod_id;
                            var dp_prod_name=r.result[i].dp_prod_name;
                            var opt="<option value='" +dp_prod_id +"'>"+dp_prod_name+"</option>";
                            $("#"+id).append(opt);
                        }
                      }else{
                        alert(r.message);
                      }
                    },error:function(r){
                      alert('请求失败，请稍候重试！！');
                    }
                });
            }else{
              alert("请选择产品")
            }
          }
          //产品模态框关闭时返显数据
          $("#confirm2").click(function(){
            var productVal=$("#product option:selected").val();//产品value
            var productTxt=$("#product option:selected").text();//产品文本

            var productBranchVal=$("#productBranch option:selected").val();//二级产品value
            var productBranchTxt=$("#productBranch option:selected").text();//二级产品文本

            var productBranchTwoVal=$("#productBranchTwo option:selected").val();//三级产品value
            var productBranchTwoTxt=$("#productBranchTwo option:selected").text();//三级产品文本

            if(productBranchTwoVal!=""){
             $("#productId").val(productBranchTwoTxt);
             $("#productId").attr("name",productBranchTwoVal);
            }
            if(productBranchTwoVal=="" && productBranchVal!=""){
             $("#productId").val(productBranchTxt);
             $("#productId").attr("name",productBranchVal);
            }

            if(productBranchTwoVal=="" && productBranchVal=="" && productVal!=""){
             $("#productId").val(productTxt);
             $("#productId").attr("name",productVal);
            }
            if(productBranchTwoVal=="" && productBranchVal=="" && productVal==""){
               $("#productId").val("");
            }

          });
          $('#content-wrapper').css('min-height',$(window).height());
          //页面加载执行
          //重置
          $("#reset").click(function(){
            $("#dateInfo").val("");
            $("#customerInfo").val("");
            $("#cus_name").val("");
            $("#productId").val("");
          })
          //判断地址栏信息
          var str=unescape(location.href);
          var data;
          if(str.indexOf("?") > -1){
          var num=str.indexOf("?");
          str=str.substr(num+1);
          data = eval(str);
          }
         if(data!=undefined){
             $("#dateInfo").val(data.dateValue);
             $("#customerInfo").val(data.customerInfo);
             $("#cus_name").val(data.operatorName);
             $("#productId").val(data.productId);
              searchInfo();
          }else{

          searchInfo();
          }
          //查询
         $("#query").click(function(){
            searchInfo();
         })
          //ajax请求函数
          function searchInfo(){
             $(".wrapper-kong").css("height",0)
             $(".content-wrapper-div").remove();
             var params = JSON.parse(localStorage.getItem("home"));
             params.class = "appCreditGetToWorkListPage";
             params.nodestarttime = $("#dateInfo").val();//日期
             params.lps_bs_cust_name=$("#customerInfo").val();//客户名称
             params.lps_ln_product=$("#productId").attr("name");//产品
             params.cus_name=$("#cus_name").val();//发起人

             $.ajax({
                 url:port,
                 data:params,
                 dataType:'json',
                 cache:false,
                 success:function(r){
                     if (r.status){
                         $.each(r.result,function(i,v){
                             $('<div class="content-wrapper-div">'
                                +'<ul>'
                                    +'<li>定价单号: <span>'+v.pk_value1+'</span></li>'
                                    +'<li>机构名称: <span>'+v.lps_bs_branch_name+'<span></li>'
                                    +'<li>发起人: <span>'+v.cus_name+'</span></li>'
                                    +'<li>申请时间: <span>'+v.nodestarttime+'</span></li>'
                                    +'<li>客户名称: <span>'+v.lps_bs_cust_name+'</span></li>'
                                    +'<li>贷款种类: <span>'+v.lps_ln_product_name+'</span></li>'
                                    +'<li>金额(元): <span>'+v.lps_ln_used_bal+'</span></li>'
                                    +'<li>期限: <span>'+v.lps_ln_term+'</span></li>'
                                    +'<li>底线价格: <span>'+v.lps_rt_bottom_price+'</span></li>'
                                    +'<li>目标利率(%): <span>'+v.lps_rt_target_price+'</span></li>'
                                    +'<li>优惠利率(%): <span>'+v.lps_rt_favor_price+'</span></li>'
                                    +'<li>执行利率(%): <span>'+v.lps_rt_strike_price+'</span></li>'
                                    +'<li>状态: <span>'+v.lps_bs_status_name+'</span></li>'
                                    +'<li style="display:none">instanceid: <span>'+v.instanceid+'</span></li>'
                                    +'<li style="display:none">wfsign: <span>'+v.wfsign+'</span></li>'
                                    +'<li style="display:none">wfname: <span>'+v.wfname+'</span></li>'
                                    +'<li style="display:none">wfstatus: <span>'+v.wfstatus+'</span></li>'
                                    +'<li style="display:none">prenodeid: <span>'+v.prenodeid+'</span></li>'
                                    +'<li style="display:none">nodeid: <span>'+v.nodeid+'</span></li>'
                                    +'<li style="display:none">lps_bs_status: <span>'+v.lps_bs_status+'</span></li>'
                                    +'<li style="display:none">currentnodeuser: <span>'+v.currentnodeuser+'</span></li>'
                                    +'<li style="display:none">唯一标识: <span>'+v.pricing_info_id+'</span></li>'
                                    +'<li style="display:none">接口标识: <span>'+v.webservice_id+'</span></li>'
                                    +'<li style="display:none">客户号: <span>'+v.lps_bs_cust_id+'</span></li>'
                                    +'<li style="display:none">起息日: <span>'+v.lps_ln_value_date+'</span></li>'
                                    +'<li style="display:none">状态ID: <span>'+v.lps_bs_status+'</span></li>'
                                +'</ul>'
                                +'<div align="right" style="">'
                                    +'<input type="button" name="" value="审批" style="width: 30%;margin:0 10px 10px 0;line-height:2px;border: 1px solid #6cf; color:red;background: #ccc;">'
                                +'</div>'
                                +'</div>'
                           +'</div>').appendTo('#content-wrapper');
                         });

                        //点击查看详情
                        $("#content-wrapper").on('click','.content-wrapper-div',function(){
                          var custInfo={};
                          custInfo.lps_sht_id=$(this).find("ul li:eq(0)").find("span").html();
                          custInfo.instanceid=$(this).find("ul li:eq(-13)").find("span").html();
                          custInfo.wfsign=$(this).find("ul li:eq(-12)").find("span").html();
                          custInfo.wfname=$(this).find("ul li:eq(-11)").find("span").html();
                          custInfo.wfstatus=$(this).find("ul li:eq(-10)").find("span").html();
                          custInfo.prenodeid=$(this).find("ul li:eq(-9)").find("span").html();
                          custInfo.nodeid=$(this).find("ul li:eq(-8)").find("span").html();
                          custInfo.lps_bs_status=$(this).find("ul li:eq(-7)").find("span").html();
                          custInfo.currentnodeuser=$(this).find("ul li:eq(-6)").find("span").html();
                          custInfo.pricing_info_id=$(this).find("ul li:eq(-5)").find("span").html();
                          custInfo.webservice_id=$(this).find("ul li:eq(-4)").find("span").html();
                          custInfo.lps_bs_cust_id=$(this).find("ul li:eq(-3)").find("span").html();
                          custInfo.lps_ln_value_date=$(this).find("ul li:eq(-2)").find("span").html();
                          custInfo.lps_bs_status=$(this).find("ul li:last").find("span").html();


                          custInfo.dateValue=$("#dateInfo").val();
                          custInfo.customerInfo=$("#customerInfo").val();
                          custInfo.productId=$("#productId").val();
                          custInfo.operatorName=$("#cus_name").val();

                          localStorage.setItem("custInfo",JSON.stringify(custInfo));
                          window.location.href="theShisuanDetails.html?key=3";

                        })
                     }else{

                         alert(r.message);
                     }

                 },error:function(r){
                     alert('用户权限不够！');
                 }
             });
          }

      })


    </script>

</html>